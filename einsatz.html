<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Einsatzboard ‚Äì Bergwacht</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
  /* üåÑ Modernisiertes Einsatzboard-Design mit konsistentem Stil */

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, sans-serif;
    background-color: #f0f4f8;
    color: #111;
    margin: 0;
    padding: 0;
    text-align: center;
  }

  header {
  background-color: #003366;
  color: white;
  padding: 1.5rem 1rem;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
  text-align: center; /* optional */
}
  .header-content {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px; /* Abstand zwischen Logo und Text */
}

.logo {
  height: 44px;
  vertical-align: middle;
}

.headline {
  font-size: 1.5rem;
  font-weight: bold;
}

.logo {
  height: 44px;
  vertical-align: middle;
}

  main {
    padding: 2rem 1rem;
  }

  h2 {
    color: #003366;
    font-size: 1.25rem;
    margin: 1.5rem 0 1rem 0;
  }

  /* üì¶ Eingabecontainer */
  .field-container {
    margin: 2rem auto;
    max-width: 640px;
    background: white;
    border-radius: 12px;
    padding: 2rem 1.5rem;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); /* vereinheitlichter Schatten */
    text-align: left;
  }

  .existing-data {
    background-color: #fefefe;
    border: 1px solid #eee;
    border-left: 4px solid #c10000;
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); /* gleich wie field-container */
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
    word-break: break-word;
  }

  /* ‚úèÔ∏è Inputs */
  input[type="text"] {
    font-size: 1rem;
    padding: 0.9rem 1rem;
    width: 100%;
    max-width: 500px;
    margin: 0.4rem auto;
    box-sizing: border-box;
    background-color: white;
    border: 1px solid #ccc;
    border-radius: 8px;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  input[type="text"]:hover {
    border-color: #999;
  }

  input[type="text"]:focus {
    border-color: #003366;
    outline: none;
    box-shadow: 0 0 0 3px rgba(0, 51, 102, 0.2);
  }

  /* üîò Button-Grunddesign */
  button {
    font-size: 1rem;
    font-weight: 500;
    padding: 0.9rem 1.2rem;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  button:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(0, 51, 102, 0.2);
  }

  /* üé® Button-Typen */
  .btn-primary {
    background-color: #003366;
    color: white;
  }

  .btn-primary:hover {
    background-color: #004080;
  }

  .btn-secondary {
    background-color: #666;
    color: white;
  }

  .btn-secondary:hover {
    background-color: #555;
  }

  .btn-danger {
    background-color: #c10000;
    color: white;
  }
/* üßØ Kompakter Stil f√ºr alle "L√∂schen"-Buttons */
button.btn-danger {
  font-size: 0.85rem;
  padding: 0.4rem 0.75rem;
  line-height: 1.2;
}

  .btn-danger:hover {
    background-color: #990000;
  }
  /* üéõ Einheitlicher Stil f√ºr graue "L√∂schen"-Buttons */
button.btn-secondary {
  background-color: #666;
  color: white;
  font-size: 0.85rem;
  padding: 0.4rem 0.75rem;
  line-height: 1.2;
}

button.btn-secondary:hover {
  background-color: #555;
}

  /* üî¢ Button-Gruppen */
  .entry-buttons button {
    font-size: 0.85rem;
    padding: 0.5rem 0.75rem;
    margin-left: 0.5rem;
  }
  .entry-buttons button {
  position: relative;
  overflow: visible;
}
  .field-container button {
  display: block;
  width: auto;
  min-width: 160px;
  margin-top: 0.5rem;
  margin-left: 0;
}

  /* üñº Galerie */
  .gallery {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1rem;
    margin-top: 1rem;
  }

  .gallery-item {
    position: relative;
    width: 140px;
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); /* einheitlich */
    padding: 0.5rem;
    text-align: center;
    transition: transform 0.2s ease;
  }

  .gallery-item:hover {
    transform: scale(1.02);
  }

  .gallery-item img {
    width: 100%;
    height: 100px;
    object-fit: cover;
    border-radius: 8px;
    cursor: pointer;
  }

  .caption {
    font-size: 0.85rem;
    margin: 0.5rem 0 0.25rem;
    color: #333;
  }

.image-buttons {
  display: flex;
  justify-content: center;
  flex-wrap: wrap; /* üß© Umbruch erm√∂glichen */
  gap: 0.25rem;
  margin-top: 0.5rem;
}

.image-buttons button {
  font-size: 0.75rem;
  padding: 4px 6px;
  flex: 1 1 auto;
  max-width: 32%;
  min-width: 28%;
}

  /* üí¨ Upload-Status */
  #uploadStatus {
    font-size: 0.95rem;
    color: #003366;
    margin-top: 0.5rem;
  }

  /* üîç Lightbox */
  #lightbox {
    display: none;
    position: fixed;
    inset: 0;
    background-color: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  #lightboxImage {
    width: 90%;
    max-height: 90%;
    border-radius: 12px;
  }

  #lightbox button {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: #fff;
    color: #000;
    border: none;
    padding: 0.5rem 1rem;
    font-size: 1rem;
    border-radius: 8px;
    cursor: pointer;
  }

  /* üì± Responsive */
  @media (max-width: 600px) {
    input[type="text"], button {
      font-size: 1rem;
      padding: 0.9rem;
    }

    .field-container {
      padding: 1.5rem 1rem;
    }

    .gallery-item {
      width: 100px;
    }
  }
.gallery-item img {
  width: 100%;
  border-radius: 4px;
  cursor: pointer;
  object-fit: cover;
  height: 100px;
}
/* üåü √úberg√§nge f√ºr Buttons & Inputs */
button,
input[type="text"] {
  transition: all 0.2s ease-in-out;
}

</style>

</head>
<body>
<header>
  <div class="header-content">
    <img src="logo.png" alt="Bergwacht Logo" class="logo">
    <span class="headline">Einsatzboard ‚Äì <span id="einsatzIdDisplay" style="color: #c10000;"></span></span>
  </div>
</header>

  <main>
    <div class="field-container">
      <h2>Funktion / Funkrufnamen</h2>
      <div id="ansprechpartnerDisplay"></div>
      <input type="text" id="ansprechName" placeholder="Funktion - z.B. EVD Bergwacht">
      <input type="text" id="ansprechRuf" placeholder="Funkrufname- z.‚ÄØB. Bergwacht 5">
      <button class="btn-primary" onclick="saveData('ansprechpartner')">Speichern</button>
    </div>

    <div class="field-container">
      <h2>Funkkan√§le</h2>
      <div id="funkkanalDisplay"></div>
      <input type="text" id="funkkanal" placeholder="z.B. HO BL 06 SB6">
      <button class="btn-primary" onclick="saveData('funkkanal')">Funkkanal speichern</button>
    </div>

    <div class="field-container">
      <h2>Hinweise</h2>
      <div id="hinweisDisplay"></div>
      <input type="text" id="hinweis" placeholder="Besondere Hinweise (Eigenschutz, Gel√§nde usw.)">
      <button class="btn-primary" onclick="saveData('hinweis')">Hinweis speichern</button>
    </div>

    <div class="field-container">
      <h2>Koordinaten</h2>
      <div id="koordDisplay"></div>
      <input type="text" id="koord" placeholder="Koordinaten z.‚ÄØB. ///W3W, UTM, GPS">
      <input type="text" id="koordInfo" placeholder="Info zur Koordinate">
      <button class="btn-primary" onclick="saveData('koordinaten')">Koordinate speichern</button>
    </div>

    <div class="field-container">
      <h2>Upload Screenshot / Bilder</h2>
      <input type="file" id="imageInput" accept="image/*">
      <input type="text" id="imageCaption" placeholder="Bildtitel eingeben">
      <div id="uploadStatus" style="display:none; font-size: 0.9rem; color: #003366; margin-top: 0.5rem;">
        ‚è≥ Bild wird hochgeladen...
      </div>
      <button class="btn-primary" onclick="uploadImage()">Bild hochladen</button>
      <div class="gallery" id="gallery"></div>
    </div>
  </main>

  <!-- Lightbox -->
  <div id="lightbox" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:1000;">
    <div style="position:relative; max-width:90%; max-height:90%;">
      <img id="lightboxImage" src="" style="width:100%; height:auto; border-radius:8px;">
      <button class="btn-secondary" onclick="closeLightbox()" style="position:absolute; top:10px; right:10px;">‚úñ</button>
    </div>
  </div>
</body>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC09wlAw-fzzThLjRoS_z_NSFvYB2TP5Bc",
      authDomain: "einsatzboard.firebaseapp.com",
      databaseURL: "https://einsatzboard-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "einsatzboard",
      storageBucket: "einsatzboard.appspot.com",
      messagingSenderId: "275404072041",
      appId: "1:275404072041:web:e6123fc9c5632cf2652ef8"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const urlParams = new URLSearchParams(window.location.search);
    const einsatz = urlParams.get("einsatz");
    if (!einsatz) {
      document.body.innerHTML = "<p style='padding:2rem;'>Kein g√ºltiger Einsatz ausgew√§hlt oder Parameter fehlt.</p>";
      throw new Error("Kein Einsatzparameter");
    }

function saveData(type) {
  const refPath = `einsaetze/${einsatz}/${type}`;
  let value;

  if (type === 'koordinaten') {
    const ort = document.getElementById("koord").value.trim();
    const info = document.getElementById("koordInfo").value.trim();
    if (!ort || !info) return;
    value = { ort, info };
  } else if (type === 'ansprechpartner') {
    const name = document.getElementById("ansprechName").value.trim();
    const ruf = document.getElementById("ansprechRuf").value.trim();
    if (!name || !ruf) return;
   value = `${name} ‚Äì ${ruf}`;
  } else {
    const inputEl = document.getElementById(type);
    const input = inputEl.value.trim();
    if (!input) return;
    value = input;
  }

  db.ref(refPath).push(value).then(() => {
    if (type === 'koordinaten') {
      document.getElementById("koord").value = "";
      document.getElementById("koordInfo").value = "";
    } else if (type === 'ansprechpartner') {
      document.getElementById("ansprechName").value = "";
      document.getElementById("ansprechRuf").value = "";
    } else {
      document.getElementById(type).value = "";
    }
  });
}

    function deleteEntry(type, key) {
  if (!confirm("Eintrag wirklich l√∂schen?")) return;

  const refPath = `einsaetze/${einsatz}/${type}/${key}`;
  db.ref(refPath).remove();
}

function renderData() {
  const sections = [
    { key: 'funkkanal', containerId: 'funkkanalDisplay' },
    { key: 'ansprechpartner', containerId: 'ansprechpartnerDisplay' },
    { key: 'hinweis', containerId: 'hinweisDisplay' },
    { key: 'koordinaten', containerId: 'koordDisplay', isCoord: true }
  ];

  sections.forEach(({ key, containerId, isCoord }) => {
    const container = document.getElementById(containerId);
    db.ref(`einsaetze/${einsatz}/${key}`).on("value", snapshot => {
      const list = snapshot.val() || {};
      container.innerHTML = "";

      for (let k in list) {
        const div = document.createElement("div");
        div.className = "existing-data";

        if (isCoord) {
          const ort = list[k].ort;
          const info = list[k].info;
          div.innerHTML = `
            <span style="text-align: left;">
              <strong>${ort}</strong><br>
              <span style="font-size: 0.9rem;">${info}</span>
            </span>
            <span class='entry-buttons'>
              <button class="btn-secondary" onclick="copyCoord('${ort}', this)">Kopieren</button>
              <button class="btn-secondary" onclick="deleteEntry('${key}', '${k}')">L√∂schen</button>
            </span>`;
        } else if (key === 'ansprechpartner') {
          const [funktion, rufname] = list[k].split(" ‚Äì ");
          div.innerHTML = `
            <span style="text-align: left;">
              <strong>${funktion}</strong><br>
              <span style="font-size: 0.9rem;">${rufname}</span>
            </span>
            <span class='entry-buttons'>
              <button class="btn-secondary" onclick="deleteEntry('${key}', '${k}')">L√∂schen</button>
            </span>`;
        } else {
          div.innerHTML = `
            <span>${list[k]}</span>
            <span class='entry-buttons'>
              <button class="btn-secondary" onclick="deleteEntry('${key}', '${k}')">L√∂schen</button>
            </span>`;
        }

        container.appendChild(div);
      }
    });
  });
}

  function uploadImage() {
  const file = document.getElementById('imageInput').files[0];
  const caption = document.getElementById('imageCaption').value.trim();
  const status = document.getElementById('uploadStatus');

  if (!file || !caption) {
    alert('Bitte ein Bild UND Titel angeben.');
    return;
  }

  status.style.display = 'block'; // Anzeige einblenden

  const reader = new FileReader();
  reader.onload = function(e) {
    const base64Image = e.target.result;
    const timestamp = Date.now();
    const time = new Date(timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

    const entry = {
      data: base64Image,
      title: caption,
      time: time
    };

    db.ref(`einsaetze/${einsatz}/bilder/${timestamp}`).set(entry)
      .then(() => {
        document.getElementById('imageInput').value = "";
        document.getElementById('imageCaption').value = "";
        loadGallery();
        status.style.display = 'none'; // Anzeige ausblenden
      })
      .catch(error => {
        console.error("Fehler beim Speichern:", error);
        alert('Fehler: ' + error.message);
        status.style.display = 'none'; // Anzeige ausblenden bei Fehler
      });
  };

  reader.onerror = function(err) {
    console.error("Fehler beim Lesen der Datei:", err);
    alert("Fehler beim Verarbeiten des Bildes.");
    status.style.display = 'none'; // Anzeige ausblenden bei Fehler
  };

  reader.readAsDataURL(file);
}

    function deleteImage(key) {
  if (!confirm("Eintrag wirklich l√∂schen?")) return;

  db.ref(`einsaetze/${einsatz}/bilder/${key}`).remove()
    .then(() => loadGallery());
}

    function downloadBase64(base64) {
      const link = document.createElement('a');
      link.href = base64;
      link.download = 'einsatzbild.jpg';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function openLightbox(base64img) {
      const lightbox = document.getElementById('lightbox');
      const img = document.getElementById('lightboxImage');
      img.src = base64img;
      lightbox.style.display = 'flex';
    }

    function closeLightbox() {
      document.getElementById('lightbox').style.display = 'none';
    }

    function loadGallery() {
      db.ref(`einsaetze/${einsatz}/bilder`).once('value', snapshot => {
        const galleryDiv = document.getElementById('gallery');
        galleryDiv.innerHTML = '';
        const images = snapshot.val();
        if (images) {
          Object.entries(images).forEach(([key, { data, title, time }]) => {
            const wrapper = document.createElement('div');
            wrapper.className = 'gallery-item';

            const captionDiv = document.createElement('div');
            captionDiv.className = 'caption';
            captionDiv.innerHTML = `<strong>${title}</strong><br><small>${time}</small>`;

            const img = document.createElement('img');
            img.src = data;
            img.alt = title;
            img.onclick = () => openLightbox(data);

            const buttons = document.createElement('div');
            buttons.className = 'image-buttons';
            buttons.innerHTML = `
              <button onclick="deleteImage('${key}')">üóë</button>
              <button onclick="downloadBase64('${data}')">‚¨áÔ∏è</button>
              <button onclick="openLightbox('${data}')">üîç</button>
            `;

            wrapper.appendChild(captionDiv);
            wrapper.appendChild(img);
            wrapper.appendChild(buttons);
            galleryDiv.appendChild(wrapper);
          });
        }
      });
    }

    const today = new Date();
const day = String(today.getDate()).padStart(2, '0');
const month = String(today.getMonth() + 1).padStart(2, '0');
const year = today.getFullYear();
const datum = `${day}.${month}.${year}`;
document.getElementById("einsatzIdDisplay").textContent = `${einsatz} (${datum})`;

    renderData();
    function copyCoord(text, buttonEl) {
  navigator.clipboard.writeText(text).then(() => {
    const popup = document.createElement("span");
    popup.textContent = "‚úì Kopiert";
    popup.style.position = "absolute";
    popup.style.background = "#003366";
    popup.style.color = "white";
    popup.style.fontSize = "0.75rem";
    popup.style.padding = "2px 6px";
    popup.style.borderRadius = "6px";
    popup.style.top = "-1.5rem";
    popup.style.right = "0";
    popup.style.zIndex = "10";
    popup.style.boxShadow = "0 2px 6px rgba(0,0,0,0.2)";
    popup.style.opacity = "0";
    popup.style.transition = "opacity 0.3s ease";

    buttonEl.style.position = "relative";
    buttonEl.style.position = "relative";
buttonEl.appendChild(popup);

    requestAnimationFrame(() => {
      popup.style.opacity = "1";
    });

    setTimeout(() => {
      popup.style.opacity = "0";
      setTimeout(() => popup.remove(), 300);
    }, 1500);
  });
}
    loadGallery();
  </script>
</body>
</html>
